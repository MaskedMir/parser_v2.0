<!DOCTYPE html>
<html lang="en">
<head>
    <style>
* {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
}

.processing-icon {
    margin-left: 5px;
}

.parser-count {
    font-size: 0.9em;
    color: #888;
    margin-left: 3px;
}

.green-check {
    color: green;
}

#autocomplete-list {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    top: 30px;
    left: 0;
    width: 100%;
}

#autocomplete-list-4 {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    top: 30px;
    left: 0;
    width: 100%;
}

#autocomplete-list-4 div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
}

.autocomplete-list--disable {
    display: none;
    overflow: hidden;
}

#autocomplete-list div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
}

#autocomplete-list div:hover,
#autocomplete-list-4 div:hover {
    background-color: #e9e9e9;
}

#autocomplete-list-3 {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    top: 30px;
    left: 0;
    width: 100%;
}

#technology-list,
#technology-list-right {
    max-height: 300px;
    overflow: auto;
}

.autocomplete-list--disable {
    display: none;
    overflow: hidden;
}

#autocomplete-list-3 div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
}

#autocomplete-list-3 div:hover {
    background-color: #e9e9e9;
}

#autocomplete-list-2,
#autocomplete-list-2-right {
    position: absolute;
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    top: 30px;
    left: 0;
    width: 100%;
}

h2 {
    margin-bottom: 15px;
}

.autocomplete-list--disable {
    display: none;
    overflow: hidden;
}

#autocomplete-list-2 div,
#autocomplete-list-2-right div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
}

#autocomplete-list-2 div:hover,
#autocomplete-list-2-right div:hover {
    background-color: #e9e9e9;
}

#search-results {
    margin-top: 20px;
}

.list-of-companies {
    border: none;
    position: relative;
    padding: 0;
    display: flex;
    gap: 10px;
}

.show-technologies {
    width: 100%;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    cursor: pointer;
}

option {
    cursor: pointer;
}

.show-technologies-container {
    display: flex;
    gap: 10px;
    border: 0;
}


 .page {
    padding: 0;
    margin: 0;
    background-color: #24283A;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 20px;
    color: #B8BFCC;
    box-sizing: border-box;
    overflow: hidden;
}

.button-container {
    display: flex;
    justify-content: space-between;
    /* gap: 20px; */
    margin-bottom: 15px;
}

/* Main */

/* вааааааааааааааааааааааааааааааааааааааа
ааааааааааааааааааааааааааааааааааааааааааааа
аааааааааааааааааааааааааа */
.main {
   display: grid;
   grid-template-columns: 350px 1fr 350px;
   transition: grid-template-columns .3s;
   min-height: 100vh;
}

.left-button {
    position: absolute;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    opacity: 0.5;
    height: 100px;
    width: 20px;
    transition: opacity .3s;
    cursor: pointer;
}

.left-button:hover {
    opacity: 1;
    transition: opacity .3s;

}

.right-button {
    position: absolute;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    transition: opacity .3s;
    opacity: 0.5;
    height: 100px;
    width: 20px;
    cursor: pointer;

}

.right-button img {
    transform: rotate(180deg);
}

.right-button:hover {
    opacity: 1;
    transition: opacity .3s;
}

.main__options {
    padding: 16px;
    width: 350px;
    min-height: 95vh;
    max-height: 100vh;
    background-color: #2F3349;
    border-right: 1px solid #424A74;
    overflow: hidden;
    transition-property: transform, padding;
    transition-duration: .3s;
}

.main_left-disable {
    grid-template-columns: 0px 1fr 350px;
    transition: grid-template-columns .3s;
}

.main_right-disable {
    grid-template-columns: 350px 1fr 0px;
    transition: grid-template-columns .3s;
}

.main_all-disable {
    grid-template-columns: 0px 1fr 0px;
    transition: grid-template-columns .3s;
}

.options_left-disable {
    padding: 0;
    transform: translateX(-350px);
    transition-property: transform, padding;
    transition-duration: .3s;
}

.options_right-disable {
    padding: 0;
    transform: translateX(350px);
    transition-property: transform, padding;
    transition-duration: .3s;
}

.options__title {
    color: rgb(255, 255, 255);
    font-family: Roboto;
    font-size: 20px;
    font-weight: 500;
    line-height: 26px;
    letter-spacing: 0%;
    text-align: left;
    margin-bottom: 20px;
}

.search-input,
.parser-depth,
.parser-depth-2 {
    width: 100%;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    margin-bottom: 15px;
}



.search-input-2 {
    width: 100%;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    margin-bottom: 15px;

}

.search-input-3 {
    width: 100%;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    margin-bottom: 15px;

}

.search-form {
    width: 100%;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    margin-bottom: 15px;
}

input::placeholder {
    color: rgb(184, 191, 204);
}

.setting__list,
#industry-list,
#technology-list {
    margin: 0;
    padding: 0;
    max-height: 200px;
    overflow: auto;
    margin-bottom: 15px;
}


.setting__item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 0 0 8px;
    border-bottom: 1px solid #414970;
    margin-bottom: 5px;
}


.label {
    display: flex;
    gap: 0 10px;
    width: 100%;
    justify-content: start;
    height: 32px;
    align-items: center;
    cursor: pointer;

}

input {
    padding: 0 10px;
}

.label__mask {
        display: block;
        min-width: 16px;
        min-height: 16px;
        outline: 1px solid #414970;
        background-color: #B8BFCC;
        position: relative;
        border-radius: 3px;

}

.label__mask_active::before {
    content: "";
    position: absolute;
    background-image: url("{{ url_for('static', path='/icon/checkbox-default_master_master_master.svg') }}");
    background-repeat: no-repeat;
    width: 100%;
    height: 100%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.label__name {
    margin-right: auto;
}

/* .label__checkbox[type="checkbox"]:checked + .label__mask::before {
    content: "";
    position: absolute;
    background-image: url("{{ url_for('static', path='/icon/checkbox-default_master_master_master.svg') }}");
    background-repeat: no-repeat;
    width: 100%;
    height: 100%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
} */

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    margin: -1px;
    border: 0;
    padding: 0;
    white-space: nowrap;
    clip-path: inset(100%);
    clip: rect(0 0 0 0);
    overflow: hidden;
}

.list-of-companies__btn {
    flex-basis: 80px;
    color: #B8BFCC;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.btn {
    border: none;
    background-color: #383D56;
    outline: 1px solid #424A74;
    border-radius: 3px;
    font-size: 14px;
    font-style: normal;
    font-weight: 500;
    line-height: 14px;
    color: #B8BFCC;
    border-radius: 6px;
    height: 32px;
    padding: 0 12px;
    cursor: pointer;
    max-width: 145px;
}

.delete {
    text-decoration: none;
    justify-self: end;
    text-decoration: none;
    color: rgb(184, 191, 204);
    padding: 0 8px;
    /* background: rgb(234, 83, 85); */
    display: flex;
    align-items: center;
    border-radius: 3px;
}

.delete::before {
    content: url("{{ url_for('static', path='/icon/delete.svg') }}");
    margin-right: 5px;
    padding-top: 3px;
}

.main__content {
    padding: 20px;
    flex-grow: 1;
    display: flex;
    position: relative;
}

.container {
    padding: 16px 16px 16px 16px;
    border: 1px solid rgb(65, 73, 112);
    border-radius: 10px;
    background: rgb(47, 51, 73);
    flex-grow: 1;
    max-height: 95vh;
    overflow: hidden;
}

.table-container {
    overflow: auto;
    max-height: 80vh;
}


*::-webkit-scrollbar {
  width: 3px; /* Ширина всего элемента навигации */
}

*::-webkit-scrollbar-track {
  background: rgb(56, 61, 86); /* Цвет дорожки */
}

*::-webkit-scrollbar-thumb {
  background-color: rgb(184, 191, 204); /* Цвет бегунка */
  border-radius: 3px; /* Округление бегунка */
  /* border: 3px solid #050c26; Оформление границ бегунка */
}

.parser-status {
    border: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
}

.main__search-block {
    display: flex;
    gap: 20px;
    border: none;
    margin-bottom: 20px;
    position: relative;
}

.search-form {
    flex-grow: 1;
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
}

.date-form {
    border: 0;
    background-color: #383D56;
    outline: 1px solid #414970;
    border-radius: 6px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    font-size: 14px;
    font-style: normal;
    font-weight: 400;
    line-height: 14px;
    color: rgb(184, 191, 204);
    height: 32px;
    width: 192px;
}

input[type='date']::-webkit-calendar-picker-indicator {
    filter: invert(100%);
}

.search-btn,
.start-stop {
border: none;
min-width: 145px;
height: 32px;
display: flex;
flex-direction: row;
justify-content: center;
align-items: center;
padding: 10px 8px 10px 8px;
border-radius: 6px;
box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
background: rgb(84, 77, 175);
color: #fff;
cursor: pointer;
}

.main__table-title {
    display: flex;
    margin-bottom: 10px;
}


.table-company {
    width: 297px;
    height: 40px;
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    flex: none;
    order: 0;
    flex-grow: 0;
    margin: 0px 0px;
    border: 1px solid rgb(65, 73, 112);
    background: rgb(56, 61, 86);
    padding: 11px 16px;

}

.vacancy {
    width: 260px;
    height: 40px;
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    padding: 0px 16px 0px 0px;
    flex: none;
    order: 0;
    flex-grow: 0;
    margin: 0px 0px;
    border: 1px solid rgb(65, 73, 112);
    background: rgb(56, 61, 86);
    padding: 11px 16px;

}

.date,
.source,
.technology {
    width: 169.67px;
    height: 40px;
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    padding: 0px 16px 0px 0px;
    flex: none;
    order: 0;
    margin: 0px 0px;
    border: 1px solid rgb(65, 73, 112);
    background: rgb(56, 61, 86);
    flex-grow: 1;
    padding: 11px 16px;
}

.text {
    padding-left: 20px;
}

.parent-string {
    height: 36px;
    color: rgb(121, 133, 153);
    font-family: Roboto;
    font-size: 14px;
    font-weight: 400;
    line-height: 115%;
    letter-spacing: 0%;
    text-align: left;
    padding: 10px 32px 10px;
    cursor: pointer;
    border-bottom: 2px dashed rgb(65, 73, 112);
    /* margin-bottom: 10px; */
}

.drop-down::before {
    content: url("{{ url_for('static', path='/icon/drop-down.svg') }}");
    /* content: url(/static/icon/drop-down.svg); */
    margin-right: 10px;
}

.list {
    display: flex;
    opacity: 1;
    overflow: hidden;
    min-height: 32px;
    /* margin-bottom: 10px; */
    padding: 5px 0 5px;
    border-bottom: 1px solid rgb(65, 73, 112);
}

.list-container {
   height: auto;
   overflow: hidden;
   transition: height 1s ease;
}


.parent-company {
    width: 297px;
    display: flex;
    align-items: center;
    padding-left: 56px;
    box-sizing: border-box;
/* Обводка */
    /* border-bottom: 1px solid rgb(65, 73, 112); */

}

.parent-vacancy {
    width: 260px;
    display: flex;
    align-items: center;
    padding-left: 16px;
    /* border-bottom: 1px solid rgb(65, 73, 112); */


}

.parent-date,
.parent-source,
.parent-technology {
    width: 169.67px;
    display: flex;
    align-items: center;
    padding-left: 16px;
    flex-grow: 1;
    /* border-bottom: 1px solid rgb(65, 73, 112); */
}


.close {
    max-height: 0;
}

/* Main */

.parsing-depth {
    border: none;
}

    .itc-select {
        position: relative;
        width: 100%;
    }

    .itc-select__toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 50px;
        padding: 8px;
        font-size: 14px;
        line-height: 14px;
        font-weight: 400;
        color: #B8BFCC;
        background-color: #383D56;
        border: 1px solid #424A74;
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
        justify-content: center;
    }

    .itc-select_show .itc-select__toggle {
        background-color: #383D56;
        border: 1px solid #414970;
        box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    }

    .itc-select__toggle::after {
        content: url("/templates/assets/icon/Polygon.svg");
        flex-shrink: 0;
        /* margin-left: 1rem; */
    }

    .itc-select__toggle:focus {
        outline: none;
    }

    .itc-select_show .itc-select__toggle::after {
        transform: rotate(180deg);
    }

    .itc-select_show .itc-select__toggle {
        border: 0;
        border-top: 1px solid #424A74;
        border-left: 1px solid #424A74;
        border-right: 1px solid #424A74;
        border-radius: 6px 6px 0 0;
    }

    .itc-select__dropdown {
        position: absolute;
        right: 0;
        left: 0;
        z-index: 2;
        display:none;
        background-color: #383D56;
        border-left: 1px solid #424A74;
        border-right: 1px solid #424A74;
        border-bottom: 1px solid #424A74;
    }

    .itc-select_show .itc-select__dropdown {
        display: block;
        border-radius: 0 0 6px 6px;
        background-color: #383D56;
    }

    .itc-select_show .itc-select__backdrop {
        display: block;
    }

    .itc-select__options {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .itc-select__option {
        padding: 10px 8px;
        border-radius: 3px;
    }

    .itc-select__option:first-child {
        display: none;
    }

    .itc-select__option_selected {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #e1f5fe;
    }

    .itc-select__option_selected::after {
        width: 0.75rem;
        height: 0.75rem;
        color: #0277bd;
        background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" height="100" width="100" class="svg-inline--fa fa-check fa-w-16" data-icon="check" data-prefix="fas" aria-hidden="true"%3E%3Cpath d="M33.964 85.547l-32.5-32.251a4.935 4.935 0 010-7.017l7.071-7.017a5.027 5.027 0 017.071 0L37.5 60.987l46.894-46.534a5.028 5.028 0 017.07 0l7.072 7.017a4.935 4.935 0 010 7.017l-57.5 57.06a5.027 5.027 0 01-7.072 0z" fill="%230277bd"/%3E%3C/svg%3E');
        background-size: cover;
        content: "";
    }

    .itc-select__option:hover {
        background-color: #2F3349;
        cursor: pointer;
        transition: 0.2s background-color ease-in-out;
        border-radius: 3px;

    }

    /* Модальное */
    body {
    overflow-x: hidden;
}

/* фон нашего модального окна */
.modalBackground {
    display: none;
    background: rgba(0, 0, 0, 0.8);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100vh;
    cursor: pointer;
    /* указываем z-индекс для корректного наслаивания */
    z-index: 1;
}

/* позиционирование самого модального окна */
.modalActive {
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    bottom: 10px;
    height: auto;
    border-radius: 10px;
    background-color: rgb(255, 255, 255);
    cursor: default;
    padding: 40px 20px;
}

/* кнопочка закрытия модального окна */
.modalClose {
    font-family: var(--font-regular);
    position: absolute;
    right: 5px;
    top: 5px;
    width: 100px;
    height: 100px;
    cursor: pointer;
}

/* сама картинка кнопочки закрытия */
.modalClose img {
    margin: 3px;
    width: 24px;
    height: 24px;
}

/* делаем позиционирование внутренних элементов относительно модального окна */
.modalWindow {
    position: relative;
}

.parsing-depth {
    position: relative;
}

.parsing-depth::before,
.parsing-depth-2::before {
    content: "";
    position: absolute;
    width: 16px;
    height: 16px;
    mask-image: url("{{ url_for('static', path='/icon/search.svg') }}");
    background-color: #B8BFCC;
    z-index: 2;
    right: 8px;
    top: 37%;
    transform: translate(0, -50%);
}


    </style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Парсер технологий компаний</title>
</head>
<body class="page">
    <div class="modalBackground">
        <div class="modalActive">
            <div class="modalClose">
                <img src="{{ url_for('static', path='/icon/drop-down.svg') }}" />
            </div>
            <div class="modalWindow">
                {% if selected_company %}

                <h2>Технологии для {{ selected_company }}</h2>
                <table border="1">
                    <thead>
                    <tr>
                        <th>Название технологии</th>
                        <th>Дата</th>
                        <th>Источник</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for tech in company_technologies %}
                    <tr>
                        <td>{{ tech.technology }}</td>
                        <td>{{ tech.date.strftime('%Y-%m-%d') if tech.date else 'N/A' }}</td>
                        <td><a href="{{ tech.url }}">{{ (tech.url or 'N/A')|truncate(30, True, "...") }}</a></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>
        </div>
    </div>
<main class="main">
    <section class="main__options options-left">
        <h1 class="options__title">Парсер технологий компаний</h1>
        <form class="parser-start" action="/digsearch/toggle_parser" method="post">
            <fieldset class="parser-status">
                <a id="parser-status">Парсер остановлен</a>
                <button id="parser-button" type="submit" class="btn start-stop">Запустить</button>
                <span id="restart-icon" style="display: none;">⚠️</span>
            </fieldset>
            <fieldset class="parsing-depth">
                <input class="parser-depth" type="text" name="parser-depth" placeholder="Глубина" autocomplete="off">
            </fieldset>
        </form>
        <div class="button-container">
            <button onclick="run_parser_hh_comp()" class="btn">Запустить парсинг компаний</button>
            <button onclick="run_parser_tv_comp()" class="btn">Запустить парсинг компаний</button>
        </div>

        
        <h2>Список компаний</h2>
        <form action="/digsearch/add_company" method="post" onsubmit="return validateFormCompany();">
            <fieldset class="list-of-companies">
                <input type="text" id="searchInput" autocomplete="off"
                       name="company_name" class="search-input" placeholder="Введите название компании..">
                <div id="autocomplete-list"></div>
                <button type="submit" class="btn">Добавить</button>
            </fieldset>
        </form>
        <ul id="company-list" class="setting__list">
            <!-- {% for item in search_list %}
            <li>
                {{ item.company_name }}
                {% set statuses = item.parser_statuses if item.parser_statuses is mapping else
                item.parser_statuses|fromjson %}
                {% for parser, status in statuses.items() %}
                {% if status %}
                <input class="label__checkbox visually-hidden" type="checkbox">
                <span class="parser-icon green-check">✅</span>
                <span class="parser-names">{{ parser.upper() }}</span>
                {% endif %}
                {% endfor %}
                {% if item.active_parsers_count > 0 %}
                <span class="processing-icon">🔄</span>
                <span class="parser-count">{{ item.active_parsers_count }}</span>
                {% endif %}
                <a href="/digsearch/delete_company/{{ item.id }}">Удалить</a>
            </li>
            {% endfor %} -->
        </ul>

        <h2>Список технологий</h2>
        <form action="/digsearch/add_technology" method="post" onsubmit="return validateFormTechnology();">
            <fieldset class="list-of-companies">
                <input type="text" name="technology_name" class="search-input-2" id="searchInput-2" autocomplete="off"
                       placeholder="Введите название технологии">
                <div id="autocomplete-list-2"></div>
                <button type="submit" class="btn">Добавить</button>
            </fieldset>
        </form>
        <ul id="technology-list" class="setting__list">
            {% for tech in technologies %}
            <li class="setting__item">
                <label class="setting__item_label label">
                    <!-- <input class="label__checkbox visually-hidden" type="checkbox"> -->
                    <span class="label__mask"></span>
                    <span class="label__name">{{ tech.name }}</span>
                    <a class="delete" href="/digsearch/delete_technology/{{ tech.id }}">Удалить</a>
                </label>
            </li>
            {% endfor %}
        </ul>

            <h2>Компании с доступными технологиями</h2>
        <form action="/digsearch/show_technologies" method="post">
            <fieldset class="show-technologies-container">
                <select class="show-technologies" name="selected_company">
                    {% for company in companies %}
                    <option class="show-technologies__option" value="{{ company.name }}"
                            {% if selected_company and company.name== selected_company %}selected{% endif %}>{{ company.name
                        }}
                    </option>
                    {% endfor %}
                </select>
                <input class="btn trigger" type="submit" value="Отобразить">
            </fieldset>
        </form>
    </section>
    <!-- Модальное -->
    
    <section class="main__content">
        <button class="left-button"><img src="{{ url_for('static', path='/icon/arrow-left.svg') }}" alt=""></button>
        <div class="container">

            <!-- Добавить данные для отправки -->
            <form action="/digsearch/autocomplete4" method="post">
            <fieldset class="main__search-block">
                <input class="search-form" type="text" name="" placeholder="Поиск" autocomplete="off">
                <div class="pagination__select">
                    <div id="pagination__drop-drown" class="pagination__select__drop-down"></div>
                </div>
                <div id="autocomplete-list-4"></div>
                <input class="date-form" type="date" placeholder="Период" value="">
                <button class="search-btn" type="button" onclick="fetchData()">Найти</button>

            </fieldset>

            </form>
            <div class="main__table-title">
            <div class="table-company">
                <span class="label__mask"></span>
                <span class="text">Компания</span>
            </div>
            <div class="vacancy">Вакансия</div>
            <div class="date">Дата публикации</div>
            <div class="source">Тип</div>
            <div class="technology">Технология</div>
            </div>
            <div class="main__table-body">
            <div class="table-container">
            </div>
        </div>
        
        </div>
        <button class="right-button"><img src="{{ url_for('static', path='/icon/arrow-left.svg') }}" alt=""></button>
    </section>
    <section class="main__options options-right">
        <h1 class="options__title">Парсер технологий компаний</h1>
        <form class="parser-start-2" action="/digsearch/toggle_parser" method="post">
            <fieldset class="parser-status">
                <a id="parser-status-2">Парсер остановлен</a>
                <button id="parser-button-2" type="submit" class="btn start-stop">Запустить</button>
                <span id="restart-icon-2" style="display: none;">⚠️</span>
            </fieldset>
            <fieldset class="parsing-depth">
                <input class="parser-depth-2" type="text" name="parser-depth" placeholder="Глубина" autocomplete="off">
            </fieldset>
        </form>
        <div class="button-container">
            <button onclick="run_parser_hh_comp()" class="btn">Запустить парсинг компаний</button>
            <button onclick="run_parser_tv_comp()" class="btn">Запустить парсинг компаний</button>
        </div>

        <h2>Список отраслей</h2>
        <form action="/digsearch/add_industry" method="post" onsubmit="return validateFormRight();">
            <fieldset class="list-of-companies">
                <input type="text" class="search-input-3" id="searchInput-3" autocomplete="off" name="industry_name"
                       placeholder="Введите название отрасли">
                <div id="autocomplete-list-3"></div>
                <button type="submit" class="btn">Добавить</button>
            </fieldset>
        </form>
        <ul id="industry-list" class="setting__list">
            {% for item in industry_list %}
            <li class="setting__item">
                <label class="setting__item_label label">
                    <!-- <input class="label__checkbox visually-hidden" type="checkbox"> -->
                    <span class="label__mask"></span>
                    <span class="label__name">{{ item.name }}</span>
                    <a class="delete" href="/digsearch/delete_industry/{{ item.id }}">Удалить</a>
                </label>
            </li>
            {% endfor %}
        </ul>

        <h2>Список технологий</h2>
        <form action="/digsearch/add_technology" method="post" onsubmit="return validateFormIndustry();">
            <fieldset class="list-of-companies">
                <input type="text" name="technology_name" class="search-input-2" id="searchInput-2-right" autocomplete="off"
                       placeholder="Введите название технологии">
                <div id="autocomplete-list-2-right"></div>
                <button type="submit" class="btn">Добавить</button>
            </fieldset>
        </form>
        <ul id="technology-list-right" class="setting__list">
            {% for tech in technologies %}
            <li class="setting__item">
                <label class="setting__item_label label">
                    <span class="label__mask"></span>
                    <span class="label__name">{{ tech.name }}</span>
                    <a class="delete" href="/digsearch/delete_technology/{{ tech.id }}">Удалить</a>
                </label>
            </li>
            {% endfor %}
        </ul>

            <h2>Компании с доступными технологиями</h2>
        <form action="/digsearch/show_technologies" method="post">
            <fieldset class="show-technologies-container">
                <select class="show-technologies" name="selected_company">
                    {% for company in companies %}
                    <option class="show-technologies__option" value="{{ company.name }}"
                            {% if selected_company and company.name== selected_company %}selected{% endif %}>{{ company.name
                        }}
                    </option>
                    {% endfor %}
                </select>
                <input class="btn trigger" type="submit" value="Отобразить">
            </fieldset>
        </form>
        <!-- {% if selected_company %}
        
        <h2>Технологии для {{ selected_company }}</h2>
        <table border="1">
            <thead>
            <tr>
                <th>Название технологии</th>
                <th>Дата</th>
                <th>Источник</th>
            </tr>
            </thead>
            <tbody>
            {% for tech in company_technologies %}
            <tr>
                <td>{{ tech.technology }}</td>
                <td>{{ tech.date.strftime('%Y-%m-%d') if tech.date else 'N/A' }}</td>
                <td><a href="{{ tech.url }}">{{ (tech.url or 'N/A')|truncate(30, True, "...") }}</a></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endif %} -->
    </section>
</main>

<script>

function run_parser_hh_comp() {
        fetch(`/digsearch/start-parsing-company-hh`, {
            method: 'GET'
        })
            .then(response => response.json())
    }

    function run_parser_tv_comp() {
        fetch(`/digsearch/start-parsing-company-tv`, {
            method: 'GET'
        })
            .then(response => response.json())
    }

    const autocompleteList2 = document.getElementById('autocomplete-list-2');
    const searchInput2 = document.getElementById('searchInput-2');
    const searchInput2Right = document.getElementById('searchInput-2-right');
    const autocompleteList2Right = document.getElementById('autocomplete-list-2-right');

    searchInput2.addEventListener('click', function () {
        autocompleteList2.classList.remove('autocomplete-list--disable');
    });
    searchInput2Right.addEventListener('click', function () {
        autocompleteList2Right.classList.remove('autocomplete-list--disable');
    });

    searchInput2.addEventListener('input', function () {
        const input = this.value;
        if (!input) {
            document.getElementById('autocomplete-list-2').innerHTML = '';
            return;
        }
        fetch(`/digsearch/autocomplete2?query=${input}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList2.classList.remove('autocomplete-list--disable');
                autocompleteList2.innerHTML = '';
                data.matches.forEach(function (item) {
                    const div = document.createElement('div');
                    div.classList.add('autocomplete-list__item')
                    div.textContent = item;
                    div.addEventListener('click', function () {
                        document.getElementById('searchInput-2').value = this.textContent;
                        autocompleteList2.innerHTML = '';
                    });
                    autocompleteList2.appendChild(div);
                });
            });
    });

    searchInput2Right.addEventListener('input', function () {
        const input = this.value;
        if (!input) {
            document.getElementById('autocomplete-list-2-right').innerHTML = '';
            return;
        }
        fetch(`/digsearch/autocomplete2?query=${input}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList2Right.classList.remove('autocomplete-list--disable');
                autocompleteList2Right.innerHTML = '';
                data.matches.forEach(function (item) {
                    const div = document.createElement('div');
                    div.classList.add('autocomplete-list__item')
                    div.textContent = item;
                    div.addEventListener('click', function () {
                        document.getElementById('searchInput-2-right').value = this.textContent;
                        autocompleteList2Right.innerHTML = '';
                    });
                    autocompleteList2Right.appendChild(div);
                });
            });
    });

    const autocompleteList3 = document.getElementById('autocomplete-list-3');
    const searchInput3 = document.getElementById('searchInput-3');

    searchInput3.addEventListener('click', function () {
        autocompleteList3.classList.remove('autocomplete-list--disable');
    })

    searchInput3.addEventListener('input', function () {
        const input = this.value;
        if (!input) {
            document.getElementById('autocomplete-list-3').innerHTML = '';
            return;
        }
        fetch(`/digsearch/autocomplete3?query=${input}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList3.classList.remove('autocomplete-list--disable');
                autocompleteList3.innerHTML = '';
                data.matches.forEach(function (item) {
                    const div = document.createElement('div');
                    div.classList.add('autocomplete-list__item')
                    div.textContent = item;
                    div.addEventListener('click', function () {
                        document.getElementById('searchInput-3').value = this.textContent;
                        autocompleteList3.innerHTML = '';
                    });
                    autocompleteList3.appendChild(div);
                });
            });
    });

    const autocompleteList4 = document.getElementById('autocomplete-list-4');
    const searchInput4 = document.querySelector('.search-form');

    searchInput4.addEventListener('click', function () {
        autocompleteList4.classList.remove('autocomplete-list--disable');
    })


    searchInput4.addEventListener('input', function () {
        const input = this.value;
        if (!input) {
            document.getElementById('autocomplete-list-4').innerHTML = '';
            return;
        }
        fetch(`/digsearch/autocomplete4?query=${input}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList4.classList.remove('autocomplete-list--disable');
                autocompleteList4.innerHTML = '';
                data.matches.forEach(function (item) {
                    const div = document.createElement('div');
                    div.classList.add('autocomplete-list__item')
                    div.textContent = item;
                    div.addEventListener('click', function () {
                        document.querySelector('.search-form').value = this.textContent;
                        autocompleteList4.innerHTML = '';
                    });
                    autocompleteList4.appendChild(div);
                });
            });
    });
    
    
    document.addEventListener('click', function (event) {
        if (event.target.className !== 'search-input-3' &&
            event.target.type !== 'submit' &&
            event.target.className !== 'autocomplete-list__item'
        ) {
            autocompleteList3.classList.add('autocomplete-list--disable')
        }
    });

    const autocompleteList = document.getElementById('autocomplete-list');
    const searchInput = document.getElementById('searchInput');

    searchInput.addEventListener('click', function () {
        autocompleteList.classList.remove('autocomplete-list--disable');
    })

    searchInput.addEventListener('input', function () {
        const input = this.value;
        if (!input) {
            document.getElementById('autocomplete-list').innerHTML = '';
            return;
        }
        fetch(`/digsearch/autocomplete?query=${input}`)
            .then(response => response.json())
            .then(data => {
                autocompleteList.classList.remove('autocomplete-list--disable');
                autocompleteList.innerHTML = '';
                data.matches.forEach(function (item) {
                    const div = document.createElement('div');
                    div.classList.add('autocomplete-list__item')
                    div.textContent = item;
                    div.addEventListener('click', function () {
                        document.getElementById('searchInput').value = this.textContent;
                        autocompleteList.innerHTML = '';
                    });
                    autocompleteList.appendChild(div);
                });
            });
    });

    function validateFormCompany() {
    var text = document.getElementById("searchInput").value;
    if (text.trim() == "") {
        alert("Введите текст!");
        return false;
    } else {
        return true;
    }
};

function validateFormRight() {
    var text = document.getElementById("searchInput-3").value;
    if (text.trim() == "") {
        alert("Введите текст!");
        return false;
    } else {
        return true;
    }
};

function validateFormIndustry() {
    var text = document.getElementById("searchInput-2-right").value;
    if (text.trim() == "") {
        alert("Введите текст!");
        return false;
    } else {
        return true;
    }
};

function validateFormTechnology() {
    var text = document.getElementById("searchInput-2").value;
    if (text.trim() == "") {
        alert("Введите текст!");
        return false;
    } else {
        return true;
    }
};

    document.addEventListener('click', function (event) {
        if (event.target.className !== 'search-input' &&
            event.target.type !== 'submit' &&
            event.target.className !== 'autocomplete-list__item'
        ) {
            autocompleteList.classList.add('autocomplete-list--disable')
        }
    });

    document.addEventListener('click', function (event) {
        if (event.target.className !== 'search-input-2' &&
            event.target.type !== 'submit' &&
            event.target.className !== 'autocomplete-list__item'
        ) {
            autocompleteList2.classList.add('autocomplete-list--disable')
        }
    });

    document.addEventListener('click', function (event) {
        if (event.target.className !== 'search-input-2' &&
            event.target.type !== 'submit' &&
            event.target.className !== 'autocomplete-list__item'
        ) {
            autocompleteList2Right.classList.add('autocomplete-list--disable')
        }
    });

    class ItcCustomSelect {
    static EL = 'itc-select';
    static EL_SHOW = 'itc-select_show';
    static EL_OPTION = 'itc-select__option';
    static EL_OPTION_SELECTED = 'itc-select__option_selected';
    static DATA = '[data-select]';
    static DATA_TOGGLE = '[data-select="toggle"]';
  
    static template(params) {
      const { name, options, targetValue } = params;
      const items = [];
      let selectedIndex = -1;
      let selectedValue = '';
      let selectedContent = 'Выберите из списка';
      options.forEach((option, index) => {
        let selectedClass = '';
        if (option[0] === targetValue) {
          selectedClass = ` ${this.EL_OPTION_SELECTED}`;
          selectedIndex = index;
          selectedValue = option[0];
          selectedContent = option[1];
        }
        items.push(`<li class="itc-select__option${selectedClass}" data-select="option"
          data-value="${option[0]}" data-index="${index}">${option[1]}</li>`);
      });
      return `<button type="button" class="itc-select__toggle" name="${name}"
        value="${selectedValue}" data-select="toggle" data-index="${selectedIndex}">
        ${selectedContent}</button><div class="itc-select__dropdown">
        <ul class="itc-select__options">${items.join('')}</ul></div>`;
    }
  
    static hideOpenSelect() {
      document.addEventListener('click', (e) => {
        if (!e.target.closest(`.${this.EL}`)) {
          const elsActive = document.querySelectorAll(`.${this.EL_SHOW}`);
          elsActive.forEach((el) => {
            el.classList.remove(this.EL_SHOW);
          });
        }
      });
    }
    static create(target, params) {
      this._el = typeof target === 'string' ? document.querySelector(target) : target;
      if (this._el) {
        return new this(target, params);
      }
      return null;
    }
    constructor(target, params) {
      this._el = typeof target === 'string' ? document.querySelector(target) : target;
      this._params = params || {};
      this._onClickFn = this._onClick.bind(this);
      if (this._params.options) {
        this._el.innerHTML = this.constructor.template(this._params);
        this._el.classList.add(this.constructor.EL);
      }
      this._elToggle = this._el.querySelector(this.constructor.DATA_TOGGLE);
      this._el.addEventListener('click', this._onClickFn);
    }
  
    _onClick(e) {
      const { target } = e;
      const type = target.closest(this.constructor.DATA).dataset.select;
      if (type === 'toggle') {
        this.toggle();
      } else if (type === 'option') {
        this._changeValue(target);
      }
    }
  
    _updateOption(el) {
      const elOption = el.closest(`.${this.constructor.EL_OPTION}`);
      const elOptionSel = this._el.querySelector(`.${this.constructor.EL_OPTION_SELECTED}`);
      if (elOptionSel) {
        elOptionSel.classList.remove(this.constructor.EL_OPTION_SELECTED);
      }
      elOption.classList.add(this.constructor.EL_OPTION_SELECTED);
      this._elToggle.textContent = elOption.textContent;
      this._elToggle.value = elOption.dataset.value;
      this._elToggle.dataset.index = elOption.dataset.index;
      this._el.dispatchEvent(new CustomEvent('itc.select.change'));
      this._params.onSelected ? this._params.onSelected(this, elOption) : null;
      return elOption.dataset.value;
    }
  
    _reset() {
      const selected = this._el.querySelector(`.${this.constructor.EL_OPTION_SELECTED}`);
      if (selected) {
        selected.classList.remove(this.constructor.EL_OPTION_SELECTED);
      }
      this._elToggle.textContent = 'Выберите из списка';
      this._elToggle.value = '';
      this._elToggle.dataset.index = '-1';
      this._el.dispatchEvent(new CustomEvent('itc.select.change'));
      this._params.onSelected ? this._params.onSelected(this, null) : null;
      return '';
    }
  
    _changeValue(el) {
      if (el.classList.contains(this.constructor.EL_OPTION_SELECTED)) {
        return;
      }
      this._updateOption(el);
      this.hide();
    }
  
    show() {
      document.querySelectorAll(this.constructor.EL_SHOW)
        .forEach((el) => {
          el.classList.remove(this.constructor.EL_SHOW);
        });
      this._el.classList.add(`${this.constructor.EL_SHOW}`);
    }
  
    hide() {
      this._el.classList.remove(this.constructor.EL_SHOW);
    }
  
    toggle() {
      this._el.classList.contains(this.constructor.EL_SHOW) ? this.hide() : this.show();
    }
  
    dispose() {
      this._el.removeEventListener('click', this._onClickFn);
    }
  
    get value() {
      return this._elToggle.value;
    }
  
    set value(value) {
      let isExists = false;
      this._el.querySelectorAll('.select__option')
        .forEach((option) => {
          if (option.dataset.value === value) {
            isExists = true;
            this._updateOption(option);
          }
        });
      if (!isExists) {
        this._reset();
      }
    }
  
    get selectedIndex() {
      return this._elToggle.dataset.index;
    }
  
    set selectedIndex(index) {
      const option = this._el.querySelector(`.select__option[data-index="${index}"]`);
      if (option) {
        this._updateOption(option);
      }
      this._reset();
    }
  }

  let selectedValue = 'hh';


    document.addEventListener("DOMContentLoaded", function () {
        
        const eventSource = new EventSource('/digsearch/sse');

        eventSource.onmessage = function (event) {
            const data = JSON.parse(event.data);

            if (data.parser_running) {
                document.getElementById("parser-status").innerText = "Парсер запущен";
                document.getElementById("parser-status-2").innerText = "Парсер запущен";
                document.getElementById("parser-button").innerText = "Остановить";
                document.getElementById("parser-button-2").innerText = "Остановить";
            } else {
                document.getElementById("parser-status").innerText = "Парсер остановлен";
                document.getElementById("parser-status-2").innerText = "Парсер остановлен";
                document.getElementById("parser-button").innerText = "Запустить";
                document.getElementById("parser-button-2").innerText = "Запустить";
            }

            if (data.should_stop) {
                document.getElementById("restart-icon").style.display = "inline";
                document.getElementById("restart-icon-2").style.display = "inline";
                document.getElementById("parser-button").disabled = true;
                document.getElementById("parser-button-2").disabled = true;
            } else {
                document.getElementById("restart-icon").style.display = "none";
                document.getElementById("restart-icon-2").style.display = "none";
                document.getElementById("parser-button").disabled = false;
                document.getElementById("parser-button-2").disabled = false;
            }

            updateCompanies(data.company);
            console.log(data)
        };

        eventSource.onerror = function (error) {
            console.error("SSE failed:", error);
        };


        ItcCustomSelect.create('#pagination__drop-drown', {
    name: 'type',
    targetValue: 'hh',
    options: [
      ['1', '1'],
      ['hh', 'Hh'],
      ['tv', 'Tv']
    ],
    onSelected(select, option) {
      console.log(`Выбранное значение: ${select.value}`);
      console.log(`Индекс выбранной опции: ${select.selectedIndex}`);
      const text = option ? option.textContent : '';
      console.log(`Выбранный текст опции: ${text}`);
    },
  });


  document.querySelector('.itc-select').addEventListener('itc.select.change', (e) => {
  const btn = e.target.querySelector('.itc-select__toggle');
  selectedValue = btn.value;
  console.log(`Выбранное значение: ${selectedValue}`);
  console.log(`Выбранное значение: ${btn.value}`);
  console.log(`Индекс выбранной опции: ${btn.dataset.index}`);
  const selected = e.target.querySelector('.itc-select__option_selected');
  const text = selected ? selected.textContent : '';
  console.log(`Выбранный текст опции: ${text}`);
  });

    });

    function updateCompanies(data) {
        const companyList = document.querySelector('#company-list');
        companyList.innerHTML = "";

        data.forEach(item => {
            const label = document.createElement('label');
            label.className = 'setting__item_label label';
            const listItem = document.createElement('li');
            listItem.className = 'setting__item';
            // const labelChackbox = document.createElement('input');
            // labelChackbox.className = 'label__checkbox visually-hidden';
            // labelChackbox.type = 'checkbox';
            const labelMask = document.createElement('span');
            labelMask.className = 'label__mask';
            const labelName = document.createElement('span');
            labelName.className = 'label__name';
            labelName.innerHTML = item.company_name;


            const statuses = JSON.parse(item.parser_statuses) || {};

            for (let parser in statuses) {
                if (statuses[parser]) {
                    const parserIcon = document.createElement('span');
                    parserIcon.className = 'parser-icon green-check';
                    parserIcon.textContent = '✅';
                    listItem.appendChild(parserIcon);

                    const parserName = document.createElement('span');
                    parserName.className = 'parser-names';
                    parserName.textContent = parser.toUpperCase();
                    listItem.appendChild(parserName);
                }
            }

            if (item.active_parsers_count > 0) {
                const icon = document.createElement('span');
                icon.className = 'processing-icon';
                icon.textContent = '🔄';
                listItem.appendChild(icon);

                const count = document.createElement('span');
                count.className = 'parser-count';
                count.textContent = item.active_parsers_count;
                listItem.appendChild(count);
            }

            const deleteLink = document.createElement('a');
            deleteLink.className = 'delete'
            deleteLink.href = `/digsearch/delete_company/${item.id}`;
            deleteLink.textContent = ' Удалить';

            companyList.appendChild(listItem);
            listItem.appendChild(label);
            // label.appendChild(labelChackbox);
            label.appendChild(labelMask);
            label.appendChild(labelName);
            label.appendChild(deleteLink);
            label.addEventListener('click', () => {
                const mask = label.querySelector('.label__mask'); 
                mask.classList.toggle('label__mask_active');
            })
        });
    }

    const label = document.querySelectorAll('.label');
    label.forEach((labelItem) => { 
        labelItem.addEventListener('click', (e) => {
            const mask = labelItem.querySelector('.label__mask'); 
            mask.classList.toggle('label__mask_active');
             });
    });

    // Данные из JSON для контента
const tableContainer = document.querySelector('.table-container');

const result = document.querySelector('.search-form');
const dateForm = document.querySelector('.date-form');
const vacancyText = document.querySelector('.vacancy');

async function fetchData() { 
    const response = await fetch(`/digsearch/vacancies?query=${result.value}&date=${dateForm.value}&dtype=${selectedValue}`);
    // const response = await fetch('test.json');
    const data = await response.json();
    console.log(dateForm.value);
    console.log(result.value);
    console.log(selectedValue);
    // tableContainer.textContent = '';
    if (selectedValue === 'hh') {
        vacancyText.textContent = 'Вакансия';
        for (const [companyName, companyData] of Object.entries(data)) {
        const parentString = document.createElement('div');
        console.log(companyName);
        parentString.className = 'parent-string';
        tableContainer.appendChild(parentString);
        const listContainer = document.createElement('div');
        listContainer.className = 'list-container';
        parentString.insertAdjacentElement('afterEnd', listContainer);

        const dropDown = document.createElement('span');
        dropDown.className = 'drop-down';

        const titleCompany = document.createElement('span');
        titleCompany.className = 'title-company';
        parentString.appendChild(dropDown);
        parentString.appendChild(titleCompany);
        titleCompany.textContent = companyName + ' (количество вакансий ' + companyData.vacancies.length + ')';

        const next = parentString.nextElementSibling;
        parentString.addEventListener('click', () => {
            next.classList.toggle('close');
        })

    companyData.vacancies.forEach(vacancy => {
        
        const list = document.createElement('div');
        list.className = 'list';
        listContainer.appendChild(list);

        const parentCompany = document.createElement('div');
        parentCompany.className = 'parent-company';
        list.appendChild(parentCompany);
        parentCompany.textContent = companyName;

        const parentVacancy = document.createElement('div');
        parentVacancy.className = 'parent-vacancy';
        list.appendChild(parentVacancy);
        parentVacancy.textContent = vacancy.title;

        const parentDate = document.createElement('div');
        parentDate.className = 'parent-date';
        list.appendChild(parentDate);
        parentDate.textContent = vacancy.date;

        const parentSource = document.createElement('div');
        parentSource.className = 'parent-source';
        list.appendChild(parentSource);
        parentSource.textContent = vacancy.source;

        const parentTechnology = document.createElement('div');
        parentTechnology.className = 'parent-technology';
        list.appendChild(parentTechnology);
        parentTechnology.textContent = vacancy.technology;

    });
}
    } else {
        vacancyText.textContent = 'Продукт';
        for (const [companyName, companyData] of Object.entries(data)) {
        const parentString = document.createElement('div');
        console.log(companyName);
        parentString.className = 'parent-string';
        tableContainer.appendChild(parentString);
        const listContainer = document.createElement('div');
        listContainer.className = 'list-container';
        parentString.insertAdjacentElement('afterEnd', listContainer);

        const dropDown = document.createElement('span');
        dropDown.className = 'drop-down';

        const titleCompany = document.createElement('span');
        titleCompany.className = 'title-company';
        parentString.appendChild(dropDown);
        parentString.appendChild(titleCompany);
        titleCompany.textContent = companyName + ' (количество вакансий ' + companyData.passport.length + ')';

        const next = parentString.nextElementSibling;
        parentString.addEventListener('click', () => {
            next.classList.toggle('close');
        })

    companyData.passport.forEach(vacancy => {
        
        const list = document.createElement('div');
        list.className = 'list';
        listContainer.appendChild(list);

        const parentCompany = document.createElement('div');
        parentCompany.className = 'parent-company';
        list.appendChild(parentCompany);
        parentCompany.textContent = companyName;

        const parentVacancy = document.createElement('div');
        parentVacancy.className = 'parent-vacancy';
        list.appendChild(parentVacancy);
        parentVacancy.textContent = vacancy.product;

        const parentDate = document.createElement('div');
        parentDate.className = 'parent-date';
        list.appendChild(parentDate);
        parentDate.textContent = vacancy.date;

        const parentSource = document.createElement('div');
        parentSource.className = 'parent-source';
        list.appendChild(parentSource);
        parentSource.textContent = vacancy.source;

        const parentTechnology = document.createElement('div');
        parentTechnology.className = 'parent-technology';
        list.appendChild(parentTechnology);
        parentTechnology.textContent = vacancy.technology;

    });
}
    }
    
}

document.addEventListener('click', function (event) {
        if (event.target.className !== 'search-form' &&
            event.target.type !== 'submit' &&
            event.target.className !== 'autocomplete-list__item'
        ) {
            autocompleteList4.classList.add('autocomplete-list--disable')
        }
    });
    
result.addEventListener('keypress', () => {
    if (event.keyCode === 13) {
        event.preventDefault();
        fetchData();
        autocompleteList4.classList.add('autocomplete-list--disable');
    }
});

// Скрыть сайтбар

const leftButton = document.querySelector('.left-button');
const rightButton = document.querySelector('.right-button');
const optionsLeft = document.querySelector('.options-left')
const optionsRight = document.querySelector('.options-right');
const main = document.querySelector('.main');
let leftDisable = false;
let rightDisable = false;
leftButton.addEventListener('click', ()=>{
    if (leftDisable == false && rightDisable == false) {
        optionsLeft.classList.add('options_left-disable');
        main.classList.add('main_left-disable');
        leftDisable = true;
    } else if (leftDisable == false && rightDisable == true) {
        optionsLeft.classList.add('options_left-disable');
        main.classList.remove('main_right-disable');
        main.classList.add('main_all-disable');
        leftDisable = true;
    } else if (leftDisable == true && rightDisable == false) {
        optionsLeft.classList.remove('options_left-disable');
        main.classList.remove('main_left-disable');
        leftDisable = false;
    } else {
        optionsLeft.classList.remove('options_left-disable');
        main.classList.remove('main_all-disable');
        main.classList.add('main_right-disable');
        leftDisable = false;
    }
});
rightButton.addEventListener('click', ()=>{
    if (leftDisable == false && rightDisable == false) {
        optionsRight.classList.add('options_right-disable');
        main.classList.add('main_right-disable');
        rightDisable = true;
    } else if (leftDisable == true && rightDisable == false) {
        optionsRight.classList.add('options_right-disable');
        main.classList.remove('main_left-disable')
        main.classList.add('main_all-disable');
        rightDisable = true;
    } else if (leftDisable == false && rightDisable == true) {
        optionsRight.classList.remove('options_right-disable');
        main.classList.remove('main_right-disable');
        rightDisable = false;
    } else {
        optionsRight.classList.remove('options_right-disable');
        main.classList.remove('main_all-disable');
        main.classList.add('main_left-disable');
        rightDisable = false;
    }
    
});

function pushDepth() {

}

// Глубина

document.querySelector('.parser-start').addEventListener('submit', function(event) {
        event.preventDefault();
        let parserDepth = document.querySelector('.parser-depth').value;
        let url = `/digsearch/toggle_parser?query=${parserDepth}`;
        
        fetch(url, {
            method: 'POST'
        }).then(response => {
            if(response.ok) {
                console.log('Запрос успешно отправлен');
            } else {
                console.error('Произошла ошибка при отправке запроса');
            }
        }).catch(error => {
            console.error('Произошла ошибка:', error);
        });
    });

    document.querySelector('.parser-start-2').addEventListener('submit', function(event) {
        event.preventDefault();
        let parserDepth = document.querySelector('.parser-depth-2').value;
        let url = `/digsearch/toggle_parser?query=${parserDepth}`;
        
        fetch(url, {
            method: 'POST'
        }).then(response => {
            if(response.ok) {
                console.log('Запрос успешно отправлен');
            } else {
                console.error('Произошла ошибка при отправке запроса');
            }
        }).catch(error => {
            console.error('Произошла ошибка:', error);
        });
    });

// Модальное

const modalTrigger = document.getElementsByClassName("trigger")[0];
const modalTrigger2 = document.getElementsByClassName("trigger")[1];

// получаем ширину отображенного содержимого и толщину ползунка прокрутки
const windowInnerWidth = document.documentElement.clientWidth;
const scrollbarWidth = parseInt(window.innerWidth) - parseInt(windowInnerWidth);

// привязываем необходимые элементы
const bodyElementHTML = document.getElementsByTagName("body")[0];
const modalBackground = document.getElementsByClassName("modalBackground")[0];
const modalClose = document.getElementsByClassName("modalClose")[0];
const modalActive = document.getElementsByClassName("modalActive")[0];

// функция для корректировки положения body при появлении ползунка прокрутки
function bodyMargin() {
    bodyElementHTML.style.marginRight = "-" + scrollbarWidth + "px";
}

// при длинной странице - корректируем сразу
bodyMargin();

// событие нажатия на триггер открытия модального окна
modalTrigger.addEventListener("click", function () {
    // делаем модальное окно видимым
    modalBackground.style.display = "block";

    // если размер экрана больше 1366 пикселей (т.е. на мониторе может появиться ползунок)
    if (windowInnerWidth >= 1366) {
        bodyMargin();
    }

    // позиционируем наше окно по середине, где 175 - половина ширины модального окна
    modalActive.style.left = "calc(50% - " + (175 - scrollbarWidth / 2) + "px)";
});

modalTrigger2.addEventListener("click", function () {
    // делаем модальное окно видимым
    modalBackground.style.display = "block";

    // если размер экрана больше 1366 пикселей (т.е. на мониторе может появиться ползунок)
    if (windowInnerWidth >= 1366) {
        bodyMargin();
    }

    // позиционируем наше окно по середине, где 175 - половина ширины модального окна
    modalActive.style.left = "calc(50% - " + (175 - scrollbarWidth / 2) + "px)";
});

// нажатие на крестик закрытия модального окна
modalClose.addEventListener("click", function () {
    modalBackground.style.display = "none";
    if (windowInnerWidth >= 1366) {
        bodyMargin();
    }
});

// закрытие модального окна на зону вне окна, т.е. на фон
modalBackground.addEventListener("click", function (event) {
    if (event.target === modalBackground) {
        modalBackground.style.display = "none";
        if (windowInnerWidth >= 1366) {
            bodyMargin();
        }
    }
});

</script>

</body>
</html>
